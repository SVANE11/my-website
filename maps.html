<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</title>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã */
        #map {
            width: 100%;
            height: calc(100vh - 60px); /* –£—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –∫–Ω–æ–ø–æ–∫ */
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav-bar {
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #fff;
            padding: 10px 0;
            border-top: 1px solid #ddd;
        }

        .nav-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4CAF50;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            text-decoration: none;
            font-size: 16px;
        }

        .nav-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
    <div class="nav-bar">
        <a href="index.html" class="nav-button">üè†</a>
        <a href="maps.html" class="nav-button">üìç</a>
        <a href="search.html" class="nav-button">üîç</a>
        <a href="profile.html" class="nav-button">üë§</a>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç API —Å –≤–∞—à–∏–º –∫–ª—é—á–æ–º -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=4cd569f0-83ba-4117-8f80-6ed73aaa6260&lang=ru_RU"></script>
    <script>
        ymaps.ready(init);

        function init() {
            const map = new ymaps.Map("map", {
                center: [55.751244, 37.618423], // –ú–æ—Å–∫–≤–∞ (–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä)
                zoom: 12
            });

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const userLocation = [position.coords.latitude, position.coords.longitude];
                        
                        // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ —Ç–µ–∫—É—â–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        map.setCenter(userLocation);

                        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º "–í—ã –∑–¥–µ—Å—å"
                        const userPlacemark = new ymaps.Placemark(userLocation, {
                            balloonContent: '–í—ã –∑–¥–µ—Å—å'
                        }, {
                            preset: 'islands#blueCircleDotIcon'
                        });
                        map.geoObjects.add(userPlacemark);

                        // –ü–æ–∏—Å–∫ –∫–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Ä—è–¥–æ–º —Å —Ç–µ–∫—É—â–∏–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º
                        searchNearby(userLocation);
                    },
                    function(error) {
                        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                        console.error("–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è:", error);
                        alert(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –û—à–∏–±–∫–∞: ${error.message}`);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º.");
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Ä—è–¥–æ–º —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        function searchNearby(location) {
            const query = "–∫–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω"; // –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∏—Å–∫ –∫–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
            const radius = 1000; // –†–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞ –≤ –º–µ—Ç—Ä–∞—Ö (1000 –º = 1 –∫–º)

            // –°–æ–∑–¥–∞—ë–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –∏ —Ä–∞–¥–∏—É—Å—É
            ymaps.geocode(location, {
                kind: 'locality',
                results: 10
            }).then(function(res) {
                const geoObjects = res.geoObjects;

                // –ò—â–µ–º –æ–±—ä–µ–∫—Ç—ã (—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã/–∫–∞—Ñ–µ) –≤ —Ä–∞–¥–∏—É—Å–µ
                ymaps.geocode(location, {
                    kind: 'business',
                    results: 10
                }).then(function(result) {
                    const businesses = result.geoObjects;

                    businesses.each(function(object) {
                        const placemark = new ymaps.Placemark(object.geometry.getCoordinates(), {
                            balloonContent: object.properties.get('name') // –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è
                        }, {
                            preset: 'islands#redDotIcon'
                        });

                        map.geoObjects.add(placemark);
                    });
                });
            });
        }
    </script>
</body>
</html>
